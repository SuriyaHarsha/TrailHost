{"ast":null,"code":"import{useEffect,useState}from\"react\";import{toast}from\"react-toastify\";import Modal from\"react-modal\";import{FaPlus}from\"react-icons/fa\";import{useSelector,useDispatch}from\"react-redux\";import{getTicket,closeTicket}from\"../redux/ticket/ticketSlice\";import{getNotes,createNote,reset as notesReset}from\"../redux/notes/noteSlice\";import{useParams,useNavigate}from\"react-router-dom\";import BackButton from\"../components/BackButton\";import Spinner from\"../components/Spinner\";import NoteItem from\"../components/NoteItem\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const customStyles={content:{width:\"600px\",top:\"50%\",left:\"50%\",right:\"auto\",bottom:\"auto\",marginRight:\"-50%\",transform:\"translate(-50%, -50%)\",position:\"relative\"}};Modal.setAppElement(\"#root\");function ViewTicket(){const[modalIsOpen,setModalIsOpen]=useState(false);const[noteText,setNoteText]=useState(\"\");const{ticket,isLoading,isSuccess,isError,message}=useSelector(state=>state.tickets);const{notes,isLoading:notesIsLoading}=useSelector(state=>state.notes);const navigate=useNavigate();const dispatch=useDispatch();const{ticketId}=useParams();useEffect(()=>{if(isError){toast.error(message);}dispatch(getTicket(ticketId));dispatch(getNotes(ticketId));// eslint-disable-next-line\n},[isError,message,ticketId]);if(isLoading){return/*#__PURE__*/_jsx(Spinner,{});}// Close ticket\nconst onTicketClose=()=>{dispatch(closeTicket(ticketId));toast.success(\"Ticket Closed\");navigate(\"/tickets\");};// Create note submit\nconst onNoteSubmit=e=>{e.preventDefault();dispatch(createNote({noteText,ticketId}));closeModal();};// Open/close modal\nconst openModal=()=>setModalIsOpen(true);const closeModal=()=>setModalIsOpen(false);if(isLoading||notesIsLoading){return/*#__PURE__*/_jsx(Spinner,{});}if(isError){return/*#__PURE__*/_jsx(\"h3\",{children:\"Something Went Wrong\"});}return/*#__PURE__*/_jsx(_Fragment,{children:isSuccess&&/*#__PURE__*/_jsxs(\"div\",{className:\"ticket-page\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"ticket-header\",children:[/*#__PURE__*/_jsx(BackButton,{url:\"/tickets\"}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"Ticket ID: \",ticket._id,/*#__PURE__*/_jsx(\"span\",{className:\"status status-\".concat(ticket.status),children:ticket.status})]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Date Submitted:\",\" \",new Date(ticket.createdAt).toLocaleString(\"en-US\")]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Product: \",ticket.product]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"ticket-desc\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Description of Issue\"}),/*#__PURE__*/_jsx(\"p\",{children:ticket.description})]}),/*#__PURE__*/_jsx(\"h2\",{children:\"Notes\"})]}),ticket.status!==\"closed\"&&/*#__PURE__*/_jsxs(\"button\",{onClick:openModal,className:\"btn\",children:[/*#__PURE__*/_jsx(FaPlus,{}),\" Add Note\"]}),/*#__PURE__*/_jsxs(Modal,{isOpen:modalIsOpen,onRequestClose:closeModal,style:customStyles,contentLabel:\"Add Note\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Add Note\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-close\",onClick:closeModal,children:\"X\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onNoteSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"textarea\",{name:\"noteText\",id:\"noteText\",className:\"form-control\",placeholder:\"Note text\",value:noteText,onChange:e=>setNoteText(e.target.value)})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn\",type:\"submit\",children:\"Submit\"})})]})]}),notes.map(note=>/*#__PURE__*/_jsx(NoteItem,{note:note},note._id)),ticket.status!==\"closed\"&&/*#__PURE__*/_jsx(\"button\",{onClick:onTicketClose,className:\"btn btn-block btn-danger\",children:\"Close Ticket\"})]})});}export default ViewTicket;","map":{"version":3,"names":["useEffect","useState","toast","Modal","FaPlus","useSelector","useDispatch","getTicket","closeTicket","getNotes","createNote","reset","notesReset","useParams","useNavigate","BackButton","Spinner","NoteItem","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","customStyles","content","width","top","left","right","bottom","marginRight","transform","position","setAppElement","ViewTicket","modalIsOpen","setModalIsOpen","noteText","setNoteText","ticket","isLoading","isSuccess","isError","message","state","tickets","notes","notesIsLoading","navigate","dispatch","ticketId","error","onTicketClose","success","onNoteSubmit","e","preventDefault","closeModal","openModal","children","className","url","_id","concat","status","Date","createdAt","toLocaleString","product","description","onClick","isOpen","onRequestClose","style","contentLabel","onSubmit","name","id","placeholder","value","onChange","target","type","map","note"],"sources":["C:/Users/jsasi/Desktop/Mern/supportdesk/frontend/src/routes/ViewTicket.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { toast } from \"react-toastify\";\r\nimport Modal from \"react-modal\";\r\nimport { FaPlus } from \"react-icons/fa\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { getTicket, closeTicket } from \"../redux/ticket/ticketSlice\";\r\nimport {\r\n  getNotes,\r\n  createNote,\r\n  reset as notesReset,\r\n} from \"../redux/notes/noteSlice\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport BackButton from \"../components/BackButton\";\r\nimport Spinner from \"../components/Spinner\";\r\nimport NoteItem from \"../components/NoteItem\";\r\n\r\nconst customStyles = {\r\n  content: {\r\n    width: \"600px\",\r\n    top: \"50%\",\r\n    left: \"50%\",\r\n    right: \"auto\",\r\n    bottom: \"auto\",\r\n    marginRight: \"-50%\",\r\n    transform: \"translate(-50%, -50%)\",\r\n    position: \"relative\",\r\n  },\r\n};\r\n\r\nModal.setAppElement(\"#root\");\r\n\r\nfunction ViewTicket() {\r\n  const [modalIsOpen, setModalIsOpen] = useState(false);\r\n  const [noteText, setNoteText] = useState(\"\");\r\n  const { ticket, isLoading, isSuccess, isError, message } = useSelector(\r\n    (state) => state.tickets\r\n  );\r\n\r\n  const { notes, isLoading: notesIsLoading } = useSelector(\r\n    (state) => state.notes\r\n  );\r\n\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const { ticketId } = useParams();\r\n\r\n  useEffect(() => {\r\n    if (isError) {\r\n      toast.error(message);\r\n    }\r\n\r\n    dispatch(getTicket(ticketId));\r\n    dispatch(getNotes(ticketId));\r\n    // eslint-disable-next-line\r\n  }, [isError, message, ticketId]);\r\n\r\n  if (isLoading) {\r\n    return <Spinner />;\r\n  }\r\n\r\n  // Close ticket\r\n  const onTicketClose = () => {\r\n    dispatch(closeTicket(ticketId));\r\n    toast.success(\"Ticket Closed\");\r\n    navigate(\"/tickets\");\r\n  };\r\n\r\n  // Create note submit\r\n  const onNoteSubmit = (e) => {\r\n    e.preventDefault();\r\n    dispatch(createNote({ noteText, ticketId }));\r\n    closeModal();\r\n  };\r\n\r\n  // Open/close modal\r\n  const openModal = () => setModalIsOpen(true);\r\n  const closeModal = () => setModalIsOpen(false);\r\n\r\n  if (isLoading || notesIsLoading) {\r\n    return <Spinner />;\r\n  }\r\n\r\n  if (isError) {\r\n    return <h3>Something Went Wrong</h3>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {isSuccess && (\r\n        <div className=\"ticket-page\">\r\n          <header className=\"ticket-header\">\r\n            <BackButton url=\"/tickets\" />\r\n            <h2>\r\n              Ticket ID: {ticket._id}\r\n              <span className={`status status-${ticket.status}`}>\r\n                {ticket.status}\r\n              </span>\r\n            </h2>\r\n            <h3>\r\n              Date Submitted:{\" \"}\r\n              {new Date(ticket.createdAt).toLocaleString(\"en-US\")}\r\n            </h3>\r\n            <h3>Product: {ticket.product}</h3>\r\n            <hr />\r\n            <div className=\"ticket-desc\">\r\n              <h3>Description of Issue</h3>\r\n              <p>{ticket.description}</p>\r\n            </div>\r\n            <h2>Notes</h2>\r\n          </header>\r\n\r\n          {ticket.status !== \"closed\" && (\r\n            <button onClick={openModal} className=\"btn\">\r\n              <FaPlus /> Add Note\r\n            </button>\r\n          )}\r\n\r\n          <Modal\r\n            isOpen={modalIsOpen}\r\n            onRequestClose={closeModal}\r\n            style={customStyles}\r\n            contentLabel=\"Add Note\"\r\n          >\r\n            <h2>Add Note</h2>\r\n            <button className=\"btn-close\" onClick={closeModal}>\r\n              X\r\n            </button>\r\n            <form onSubmit={onNoteSubmit}>\r\n              <div className=\"form-group\">\r\n                <textarea\r\n                  name=\"noteText\"\r\n                  id=\"noteText\"\r\n                  className=\"form-control\"\r\n                  placeholder=\"Note text\"\r\n                  value={noteText}\r\n                  onChange={(e) => setNoteText(e.target.value)}\r\n                ></textarea>\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <button className=\"btn\" type=\"submit\">\r\n                  Submit\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </Modal>\r\n\r\n          {notes.map((note) => (\r\n            <NoteItem key={note._id} note={note} />\r\n          ))}\r\n\r\n          {ticket.status !== \"closed\" && (\r\n            <button\r\n              onClick={onTicketClose}\r\n              className=\"btn btn-block btn-danger\"\r\n            >\r\n              Close Ticket\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ViewTicket;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}